var assert = require("assert");
var doc = require("./doc/doc");
var fs = require("fs");
var doc_search_index = require("./doc/doc_search_index");


describe('query', function () {
    describe('indexes', function () {
        describe('search', function () {
            var indexes = {};
            var index = function (fieldName, strValue, options) {
                indexes[fieldName] = [strValue, options];
            };
            var search = <%= File.read('../src/query/indexes/search.js') %>;
            search(doc);
            it('should index inner text', function () {
                assert.equal(indexes.innerText[0].startsWith('College van Beroep voor het bedrijfsleven'), true);
            });
            it('should index like we expect', function () {
                assert.equal(JSON.stringify(doc_search_index), JSON.stringify(indexes));
            });
        });
    });
    describe('shows', function () {
        describe('doc', function () {
            it('should behave like we expect', function () {
                var showDoc = <%= File.read('../src/query/shows/doc.js') %>;
                assert.equal(fs.readFileSync('./doc/doc_html.html', 'utf-8'), showDoc(doc));
            });
        });
    });
});
describe('query_dev', function () {
    describe('views', function () {
        describe('docs_with_nonpara_markup', function () {
            describe('map', function () {
                var emitted = [];
                var emit = function (key, val) {
                    emitted.push([key, val])
                };
                var f = <%= File.read('../src/query_dev/views/docs_with_nonpara_markup/map.js') %>;
                f(doc);
                it('should behave like we expect', function () {
                    assert.equal(JSON.stringify(emitted), JSON.stringify([[['2003', '09', '12'], 1]]));
                });
            });
        });
        describe('docs_with_rich_markup', function () {
            describe('map', function () {
                var emitted = [];
                var emit = function (key, val) {
                    emitted.push([key, val])
                };
                var f = <%= File.read('../src/query_dev/views/docs_with_rich_markup/map.js') %>;
                f(doc);
                console.log(emitted);
                it('should behave like we expect', function () {
                    assert.equal(emitted.length, 0);
                });
            });
        });
    });
});
