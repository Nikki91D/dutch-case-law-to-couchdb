<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <style>

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin: auto;
            position: relative;
            width: 960px;
        }

        .node {
            border: solid 1px white;
            font: 10px sans-serif;
            line-height: 12px;
            overflow: hidden;
            position: absolute;
            text-indent: 2px;
        }

        .node:hover {
            background: beige !important;
            min-width: 65px !important;
            height: auto !important;
            z-index: 9999 !important;
        }

        .label-pattern-count:before {
            content: " (";
        }

        .label-pattern-count:after {
            content: ")";
        }

        .label-pattern-count {
            font-size: 0.8em;
        }
    </style>
</head>
<body>

<script src="//d3js.org/d3.v3.min.js"></script>
<script>

    var margin = {top: 0, right: 0, bottom: 0, left: 0},
            width = 600 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

    var color = d3.scale.category20c();

    var treemap = d3.layout.treemap()
            .size([width, height])
            .sticky(true)
            .value(function (d) {
                return d.size;
            });

    var div = d3.select("body").append("div")
            .style("position", "relative")
            .style("width", (width + margin.left + margin.right) + "px")
            .style("height", (height + margin.top + margin.bottom) + "px")
            .style("left", margin.left + "px")
            .style("top", margin.top + "px");


    var exampleData = {
        "name": "title patterns",
        "children": [
            {
                "name": "beslissing",
                "children": [
                    {"name": "AgglomerativeCluster", "size": 3938},
                    {"name": "CommunityStructure", "size": 3812},
                    {"name": "HierarchicalCluster", "size": 6714},
                    {"name": "MergeEdge", "size": 743}
                ]
            },
            {
                "name": "something",
                "children": [
                    {"name": "AxisLayout", "size": 6725},
                    {"name": "BundledEdgeRouter", "size": 3727},
                    {"name": "CircleLayout", "size": 9317},
                    {"name": "CirclePackingLayout", "size": 12003},
                    {"name": "DendrogramLayout", "size": 4853},
                    {"name": "ForceDirectedLayout", "size": 8411},
                    {"name": "IcicleTreeLayout", "size": 4864},
                    {"name": "IndentedTreeLayout", "size": 3174},
                    {"name": "Layout", "size": 7881},
                    {"name": "NodeLinkTreeLayout", "size": 12870},
                    {"name": "PieLayout", "size": 2728},
                    {"name": "RadialTreeLayout", "size": 12348},
                    {"name": "RandomLayout", "size": 870},
                    {"name": "StackedAreaLayout", "size": 9121},
                    {"name": "TreeMapLayout", "size": 9191}
                ]
            }
        ]
    };


    function position() {
        this.style("left", function (d) {
                    return d.x + "px";
                })
                .style("top", function (d) {
                    return d.y + "px";
                })
                .style("width", function (d) {
                    return Math.max(0, d.dx - 1) + "px";
                })
                .style("min-width", function (d) {
                    return Math.max(0, d.dx - 1) + "px";
                })
                .style("height", function (d) {
                    return Math.max(0, d.dy - 1) + "px";
                })
                .style("min-height", function (d) {
                    return Math.max(0, d.dy - 1) + "px";
                });
    }
    d3.json("https://rechtspraak.cloudant.com/docs/" +
            "_design/stats/" +
            "_list/value_large_enough/" +
            "section_roles?" +
            "group_level=2" +
            "&startkey=[\"\"]" +
            "&endkey=[\"z\"]",
            function (error, result) {
                if (error) throw error;

                var aggr = {};
                result.forEach(function (row) {
                    aggr[row.key[0]] = aggr[row.key[0]] ? aggr[row.key[0]] : {};
                    aggr[row.key[0]][row.key[1]] = row.value;
                });

                var rootChildren = [];
                for (var name in aggr) {
                    if (aggr.hasOwnProperty(name)) {
                        var patternChildren = [];
                        var aggrPatterns = aggr[name];
                        for (var pattern in aggrPatterns) {
                            if (aggrPatterns.hasOwnProperty(pattern)) {
                                patternChildren.push({
                                    name: pattern,
                                    size: aggrPatterns[pattern]
                                });
                            }
                        }

                        rootChildren.push({
                            name: name,
                            children: patternChildren
                        });
                    }
                }
                var root = {
                    name: "title patterns",
                    children: rootChildren
                };

                var node = div.datum(root).selectAll(".node")
                        .data(treemap.nodes)
                        .enter().append("div")
                        .attr("class", "node")
                        .call(position)
                        .style("background", function (d) {
                            return d.children ? color(d.name) : null;
                        });
                node.append("span")
                        .attr("class", "label-pattern")
                        .text(function (d) {
                            return d.children ? null : d.name;
                        });
                node.append("span")
                        .attr("class", "label-pattern-count")
                        .text(function (d) {
                            return d.children ? null : d.size;
                        });
            }
    );
</script>
</body>
</html>